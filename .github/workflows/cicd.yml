name: Update Parent Repo

on:
  push:
    branches:
      - main

jobs:
  update-parent:
    runs-on: ubuntu-latest
    steps:
      # Clona el submodule (repositorio actual) en la carpeta raíz
      - name: Checkout submodule
        uses: actions/checkout@v4

      # Clona el repositorio principal en la carpeta "parent-repo"
      - name: Checkout parent repo
        uses: actions/checkout@v4
        with:
          repository: Ecommerce-Nest-Microservicios/ecommerce_app
          path: parent-repo # Carpeta donde se clonará el repositorio principal
          token: ${{ secrets.ORG_TOKEN }} # Usa un token con permisos suficientes

      # Actualiza la referencia del submodule en el repositorio principal
      - name: Update submodule reference in parent repo
        run: |
          cd parent-repo  # Cambia a la carpeta del repositorio principal
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git submodule update --init --recursive  # Actualiza los submodules
          git add ${{ github.event.repository.name }}  # Agrega los cambios del submodule
          git commit -m "Actualizada referencia del submodule ${{ github.event.repository.name }}"  # Haz commit de los cambios
          git push origin main  # Sube los cambios al repositorio principal
